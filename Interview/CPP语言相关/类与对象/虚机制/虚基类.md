### C++虚基类的作用、用法和意义

如果一个派生类有多个直接基类，而这些直接基类又有一个共同的基类(菱形继承问题)，**则在最终的派生类中会保留该间接共同基类数据成员的多份同名成员（浪费存储空间、存在二义性）**。这种现象是人们不希望出现的。C++提供虚基类(virtual base class)的方法，**使得在继承间接共同基类时只保留一份成员**。虚基类并不是在声明基类时声明的，而是在声明派生类时，**指定继承方式时声明的**。因为一个基类可以在生成一个派生类时作为虚基类，而在生成另一个派生类时不作为虚基类。

底层实现原理与编译器相关，一般通过**虚基类表指针**和**虚基类表**实现，每个虚继承的子类都有一个虚基类指针（占用一个指针的存储空间）和虚基类表（不占用类对象的存储空间）（需要强调的是，虚基类依旧会在子类里面存在拷贝，只是仅仅最多存在一份而已，并不是不在子类里面了）；当虚继承的子类被当做父类继承时，虚基类指针也会被继承。

实际上，vbptr 指的是**虚基类表指针**（virtual base table pointer），该指针指向了一个虚基类表（virtual table），**虚表中记录了虚基类与本类的偏移地址**；通过偏移地址，这样就找到了虚基类成员，而虚继承也不用像普通多继承那样维持着公共基类（虚基类）的两份同样的拷贝，节省了存储空间。

### 虚继承、虚函数对比

* 相同之处：都利用了虚指针（均占用类的存储空间）和虚表（均不占用类的存储空间）
* 不同之处：
  * 虚继承
    * 虚基类依旧存在继承类中，只占用存储空间
    * 虚基类表存储的是虚基类相对**直接继承类的偏移**
  * 虚函数
    * 虚函数不占用存储空间
    * 虚函数表存储的是**虚函数地址**

