# 什么是多态？多态如何实现？
面试高频指数：★★★★★

### 多态

* 多态，即多种状态（形态）。简单来说，我们可以将多态定义为消息以多种形式显示的能力。
* 多态是以封装和继承为基础的。
* C++ 多态分类及实现：
  1. **重载多态**（Ad-hoc Polymorphism，编译期）：函数重载、运算符重载
  2. **子类型多态**（Subtype Polymorphism，运行期）：虚函数
  3. **参数多态性**（Parametric Polymorphism，编译期）：类模板、函数模板
  4. **强制多态**（Coercion Polymorphism，编译期/运行期）：基本类型转换、自定义类型转换

多态是指同样的消息被不同类型的对象接受时导致不同的行为。所谓消息是指对类的成员函数的调用，不同的行为是指不同的实现，也就调用不同的函数。换言之，多态指的就是用同样的接口访问功能不同的函数，从而实现“一个接口，多种方法”。


#### 静态多态（编译期/早绑定）

**重载多态**:函数重载

```cpp
class A
{
public:
    void do(int a);
    void do(int a, int b);
};

```
**强制多态**

```c++
int a=1;
float b=2.4f;
float re = a+b;
```
这里的加法运算符在进行浮点数和整形数相加时，首先进行类型强制转换，把整形数变为浮点数再相加的情况就是强制多态的实例。


#### 动态多态（运行期期/晚绑定）

* **虚函数**：用 virtual 修饰成员函数，使其成为虚函数
* **动态绑定**：当使用基类的引用或指针调用一个虚函数时将发生动态绑定
* **采用函数模板**，它可以用来创建一个通用的函数，以支持多种不同形参，避免重载函数的函数体重复设计，通过给出不同的类型参数，使得一个结构有多种类型。以实现参数多态。


**注意：**

* 可以将派生类的对象赋值给基类的指针或引用，反之不可
* 普通函数（非类成员函数）不能是虚函数
* **静态函数（static）不能是虚函数**
* **构造函数不能是虚函数**（**因为在调用构造函数时，虚表指针并没有在对象的内存空间中，必须要构造函数调用完成后才会形成虚表指针**）
* **内联函数不能是表现多态性时的虚函数**



#### 子类型多态（Subtype Polymorphism，运行期)实现方法：
多态是通过虚函数实现的，**虚函数的地址**保存在==虚函数表==中，==虚函数表==的地址保存在含有虚函数的类的实例对象的内存空间中。

##### 实现过程：

1. 在类中用 virtual 关键字声明的函数叫做虚函数；
2. 存在虚函数的类都有一个虚函数表，当创建一个该类的对象时，该对象有一个指向虚函数表的虚表指针（虚函数表和类对应的，虚表指针是和对象对应）；
3. **当基类指针指向派生类对象**，==基类指针调用虚函数时，基类指针指向派生类的虚表指针==，由于该虚表指针指向派生类虚函数表，**通过偏移量，寻找相应的虚函数**。

